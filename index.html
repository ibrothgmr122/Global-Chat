<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Chat - Snapchat Style</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        
        .message-bubble {
            animation: slideIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .snap-shadow {
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }
        
        .chat-input {
            background: rgba(255, 255, 255, 0.95);
        }
        
        .typing-indicator {
            display: inline-block;
            animation: pulse 1.5s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.4; }
            50% { opacity: 1; }
        }
    </style>
</head>
<body class="h-screen overflow-hidden">
    <!-- Login Screen -->
    <div id="loginScreen" class="flex items-center justify-center h-full">
        <div class="bg-white rounded-3xl p-8 snap-shadow max-w-md w-full mx-4">
            <div class="text-center mb-8">
                <svg class="w-20 h-20 mx-auto mb-4 text-yellow-400" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"/>
                </svg>
                <h1 class="text-4xl font-bold text-gray-800 mb-2">Global Chat</h1>
                <p class="text-gray-600">Join the worldwide conversation</p>
            </div>
            
            <div>
                <input 
                    type="text" 
                    id="nameInput" 
                    placeholder="Enter your name"
                    maxlength="20"
                    class="w-full px-4 py-3 rounded-full border-2 border-gray-300 focus:border-purple-500 focus:outline-none text-center text-lg mb-4"
                    onkeypress="if(event.key === 'Enter') joinChat()"
                />
                <button 
                    onclick="joinChat()"
                    class="w-full bg-gradient-to-r from-purple-500 to-pink-500 text-white py-3 rounded-full font-semibold text-lg hover:shadow-lg transition-shadow"
                >
                    Join Chat üöÄ
                </button>
            </div>
            
            <div class="mt-6 text-center">
                <p class="text-sm text-gray-500" id="onlineCount">0 people online</p>
            </div>
        </div>
    </div>

    <!-- Chat Screen -->
    <div id="chatScreen" class="hidden flex flex-col h-full">
        <!-- Header -->
        <div class="bg-white snap-shadow px-6 py-4 flex items-center justify-between">
            <div>
                <h2 class="text-xl font-bold text-gray-800">Global Chat üåç</h2>
                <p class="text-sm text-gray-600" id="onlineUsers">0 people chatting</p>
            </div>
            <div>
                <span class="text-sm font-semibold text-purple-600 bg-purple-100 px-4 py-2 rounded-full" id="currentUser"></span>
            </div>
        </div>

        <!-- Messages Container -->
        <div id="messagesContainer" class="flex-1 overflow-y-auto p-4 space-y-3">
            <!-- Messages will appear here -->
        </div>

        <!-- Typing Indicator -->
        <div id="typingIndicator" class="px-6 text-sm text-white opacity-75 hidden">
            <span class="typing-indicator">Someone is typing...</span>
        </div>

        <!-- Input Area -->
        <div class="chat-input p-4 snap-shadow">
            <div class="flex items-center gap-2 max-w-4xl mx-auto">
                <input 
                    type="text" 
                    id="messageInput" 
                    placeholder="Type a message..."
                    class="flex-1 px-4 py-3 rounded-full border-2 border-gray-300 focus:border-purple-500 focus:outline-none"
                    onkeypress="if(event.key === 'Enter') sendMessage()"
                    oninput="handleTyping()"
                />
                <button 
                    onclick="sendMessage()"
                    class="bg-gradient-to-r from-purple-500 to-pink-500 text-white p-3 rounded-full hover:shadow-lg transition-shadow"
                >
                    <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let userName = '';
        let messages = [];
        let users = new Set();
        let typingTimeout;
        let isTyping = false;

        // Color palette for user avatars
        const colors = [
            'bg-red-500', 'bg-blue-500', 'bg-green-500', 'bg-yellow-500',
            'bg-purple-500', 'bg-pink-500', 'bg-indigo-500', 'bg-teal-500',
            'bg-orange-500', 'bg-cyan-500'
        ];

        function getUserColor(name) {
            let hash = 0;
            for (let i = 0; i < name.length; i++) {
                hash = name.charCodeAt(i) + ((hash << 5) - hash);
            }
            return colors[Math.abs(hash) % colors.length];
        }

        function joinChat() {
            const nameInput = document.getElementById('nameInput');
            const name = nameInput.value.trim();
            
            if (!name) {
                nameInput.classList.add('border-red-500');
                nameInput.placeholder = 'Please enter your name!';
                return;
            }
            
            userName = name;
            users.add(userName);
            
            // Switch screens
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('chatScreen').classList.remove('hidden');
            document.getElementById('currentUser').textContent = userName;
            
            // Add system message
            addSystemMessage(`${userName} joined the chat! üëã`);
            updateOnlineCount();
            
            // Focus on message input
            document.getElementById('messageInput').focus();
            
            // Store in localStorage to simulate persistence
            localStorage.setItem('chatUser', userName);
            loadMessages();
        }

        function sendMessage() {
            const input = document.getElementById('messageInput');
            const text = input.value.trim();
            
            if (!text) return;
            
            const message = {
                id: Date.now(),
                user: userName,
                text: text,
                timestamp: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }),
                color: getUserColor(userName)
            };
            
            messages.push(message);
            saveMessages();
            displayMessage(message);
            
            input.value = '';
            scrollToBottom();
        }

        function displayMessage(message, isSystem = false) {
            const container = document.getElementById('messagesContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message-bubble';
            
            if (isSystem) {
                messageDiv.innerHTML = `
                    <div class="text-center">
                        <span class="bg-white bg-opacity-25 text-white text-sm px-4 py-2 rounded-full">
                            ${message.text}
                        </span>
                    </div>
                `;
            } else {
                const isOwnMessage = message.user === userName;
                const alignClass = isOwnMessage ? 'justify-end' : 'justify-start';
                const bgClass = isOwnMessage ? 'bg-purple-500 text-white' : 'bg-white text-gray-800';
                
                messageDiv.innerHTML = `
                    <div class="flex ${alignClass} items-end gap-2">
                        ${!isOwnMessage ? `
                            <div class="${message.color} w-8 h-8 rounded-full flex items-center justify-center text-white font-bold text-sm flex-shrink-0">
                                ${message.user.charAt(0).toUpperCase()}
                            </div>
                        ` : ''}
                        <div class="max-w-xs lg:max-w-md">
                            ${!isOwnMessage ? `<p class="text-xs text-white mb-1 ml-1 font-semibold">${message.user}</p>` : ''}
                            <div class="${bgClass} rounded-2xl px-4 py-2 snap-shadow">
                                <p class="break-words">${escapeHtml(message.text)}</p>
                                <p class="text-xs mt-1 ${isOwnMessage ? 'text-purple-100' : 'text-gray-500'}">${message.timestamp}</p>
                            </div>
                        </div>
                        ${isOwnMessage ? `
                            <div class="${message.color} w-8 h-8 rounded-full flex items-center justify-center text-white font-bold text-sm flex-shrink-0">
                                ${message.user.charAt(0).toUpperCase()}
                            </div>
                        ` : ''}
                    </div>
                `;
            }
            
            container.appendChild(messageDiv);
            scrollToBottom();
        }

        function addSystemMessage(text) {
            const message = {
                text: text,
                timestamp: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
            };
            displayMessage(message, true);
        }

        function handleTyping() {
            // Clear existing timeout
            clearTimeout(typingTimeout);
            
            // Show typing indicator for others (simulated)
            typingTimeout = setTimeout(() => {
                // Hide typing indicator
            }, 1000);
        }

        function scrollToBottom() {
            const container = document.getElementById('messagesContainer');
            container.scrollTop = container.scrollHeight;
        }

        function updateOnlineCount() {
            const count = users.size;
            const onlineCountElem = document.getElementById('onlineCount');
            const onlineUsersElem = document.getElementById('onlineUsers');
            
            if (onlineCountElem) {
                onlineCountElem.textContent = `${count} ${count === 1 ? 'person' : 'people'} online`;
            }
            if (onlineUsersElem) {
                onlineUsersElem.textContent = `${count} ${count === 1 ? 'person' : 'people'} chatting`;
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // LocalStorage functions for persistence
        function saveMessages() {
            localStorage.setItem('chatMessages', JSON.stringify(messages));
        }

        function loadMessages() {
            const saved = localStorage.getItem('chatMessages');
            if (saved) {
                messages = JSON.parse(saved);
                // Only show last 50 messages
                messages = messages.slice(-50);
                messages.forEach(msg => displayMessage(msg));
            }
            
            // Load users
            const savedUsers = localStorage.getItem('chatUsers');
            if (savedUsers) {
                users = new Set(JSON.parse(savedUsers));
            }
            users.add(userName);
            saveUsers();
        }

        function saveUsers() {
            localStorage.setItem('chatUsers', JSON.stringify([...users]));
        }

        // Simulate real-time updates (in a real app, you'd use WebSockets)
        setInterval(() => {
            const saved = localStorage.getItem('chatMessages');
            if (saved) {
                const loadedMessages = JSON.parse(saved).slice(-50);
                if (loadedMessages.length > messages.length) {
                    const newMessages = loadedMessages.slice(messages.length);
                    messages = loadedMessages;
                    newMessages.forEach(msg => {
                        if (msg.user !== userName) {
                            displayMessage(msg);
                        }
                    });
                }
            }
            
            const savedUsers = localStorage.getItem('chatUsers');
            if (savedUsers) {
                users = new Set(JSON.parse(savedUsers));
                updateOnlineCount();
            }
        }, 1000);

        // Update online count periodically
        setInterval(updateOnlineCount, 5000);
        
        // Initial update
        updateOnlineCount();
    </script>
</body>
</html>
